# 세일즈 어시스턴트 데이터베이스 스키마 v2

## 1. 저장소 구조

```
┌─────────────────────────────────────────────────────────┐
│                    Notion (전부)                         │
│              메인 데이터 저장소 - 직접 관리               │
├─────────────────────────────────────────────────────────┤
│  고객 DB        스크립트 DB      자료 DB       전략 DB    │
│  (CRM)         (언어팩)        (자료관리)    (AI 설정)   │
└─────────────────────────────────────────────────────────┘

> Supabase 사용 안 함
> 대화 내용은 텍스트로 직접 붙여넣기
```

---

## 2. Notion 데이터베이스 구조

### 2.1 고객 DB (CRM)

고객/리드 정보를 관리하는 메인 CRM 데이터베이스

| 속성명 | 속성 타입 | 필수 | 설명 | 예시 |
|--------|----------|------|------|------|
| 업장명 | Title | ✅ | 병원/업체명 | "○○성형외과" |
| 담당자 | Text | | 담당자 이름 | "김○○ 실장" |
| 연락처 | Phone | | 전화번호 | "010-1234-5678" |
| 이메일 | Email | | 이메일 주소 | "contact@hospital.com" |
| 상태 | Select | ✅ | 상담 상태 | 리드/상담중/계약완료/이탈 |
| 상담메모 | Text | | 최근 상담 내용 및 특이사항 | "가격 문의함, 다음주 결정 예정" |
| 다음액션 | Text | | 다음에 해야 할 일 | "월요일 오전 팔로업 전화" |
| 최근연락일 | Date | | 마지막 연락 날짜 | 2024-01-15 |
| 주소 | Text | | 업장 주소 | "서울시 중구 명동..." |
| 분류 | Select | | 업종 분류 | 성형외과/피부과/치과/기타 |
| 예상매출 | Number | | 예상 계약 금액 | 1200000 |
| 유입경로 | Select | | 리드 유입 경로 | 스레드/인스타/소개/직접영업 |
| 담당자메모 | Text | | 담당자 개인 성향 메모 | "직접적인 커뮤니케이션 선호" |

#### Select 옵션

**상태:**
- 🔵 리드 (새로운 잠재 고객)
- 🟡 상담중 (상담 진행 중)
- 🟢 계약완료 (계약 체결됨)
- 🔴 이탈 (이탈/거절)
- ⚪ 보류 (나중에 다시 연락)

**분류:**
- 성형외과
- 피부과
- 치과
- 안과
- 한의원
- 기타

**유입경로:**
- 스레드
- 인스타그램
- 지인소개
- 직접영업
- 기타

---

### 2.2 스크립트 DB (언어팩)

상담 시 사용하는 스크립트 모음

| 속성명 | 속성 타입 | 필수 | 설명 | 예시 |
|--------|----------|------|------|------|
| 제목 | Title | ✅ | 스크립트 제목 | "문자 첫 연락" |
| 카테고리 | Select | ✅ | 상황별 분류 | 첫연락/질문응대/이의제기 등 |
| 내용 | Text | ✅ | 스크립트 본문 | "안녕하세요, ○○병원 담당자님..." |
| 태그 | Multi-select | | 검색용 태그 | 문자, 첫인사, 병원 |
| 사용빈도 | Number | | 사용 횟수 (정렬용) | 15 |
| 메모 | Text | | 사용 시 참고사항 | "오전에 연락할 때 사용" |
| 효과적인상황 | Text | | 언제 효과적인지 | "고객이 바쁠 때" |

#### Select 옵션

**카테고리:**
- 📱 첫 연락 (첫 연락 시)
- 💬 관심 표현 (관심 보일 때)
- ❓ 질문 응대 (질문에 답변)
- 🛡️ 이의 제기 (거절/반대 응대)
- ✅ 클로징 (계약 마무리)
- 🔄 후속 관리 (계약 후 관리)

#### 샘플 데이터

```markdown
# 제목: 문자 첫 연락
# 카테고리: 첫 연락
# 내용:
안녕하세요, ○○병원 담당자님.

저는 구글맵 마케팅 전문 컨설턴트 ○○○입니다.

외국인 환자 유치에 관심 있으신 병원들을 대상으로
구글맵 상위노출 서비스를 안내드리고 있습니다.

잠깐 통화 가능하실까요?

# 태그: 문자, 첫인사
# 메모: 오전 10시~12시 사이 발송 효과적
```

```markdown
# 제목: "비싸요" 응대
# 카테고리: 이의 제기
# 내용:
가격이 부담되신다는 말씀 충분히 이해합니다.

다만, 저희 서비스는 단순 노출이 아니라
실제 외국인 환자 유입으로 이어지는 걸 목표로 합니다.

현재 ○○병원의 경우, 서비스 시작 3개월 만에
외국인 환자 문의가 200% 증가했습니다.

ROI 관점에서 한번 검토해보시겠어요?

# 태그: 가격, 비싸, 이의제기
# 효과적인상황: 가격 저항이 있지만 관심은 있는 경우
```

---

### 2.3 자료 DB

상담 시 공유하는 자료 관리

| 속성명 | 속성 타입 | 필수 | 설명 | 예시 |
|--------|----------|------|------|------|
| 자료명 | Title | ✅ | 자료 이름 | "포트폴리오 2024" |
| 카테고리 | Select | ✅ | 자료 분류 | 소개/가격/사례/계약 |
| 링크 | URL | ✅ | 공유 링크 | "https://drive.google.com/..." |
| 설명 | Text | | 자료 설명 | "최근 성공 사례 모음" |
| 파일형식 | Select | | 파일 타입 | PDF/이미지/링크/영상 |
| 최종수정일 | Date | | 마지막 업데이트 | 2024-01-10 |

#### Select 옵션

**카테고리:**
- 📄 소개 (회사/서비스 소개)
- 💰 가격 (가격표, 패키지)
- 📊 사례 (성공 사례, 포트폴리오)
- 📝 계약 (계약서, 이용약관)

**파일형식:**
- PDF
- 이미지
- 링크
- 영상
- 문서

---

### 2.4 세일즈 단계 DB (커스텀 가능)

영업 단계별 목표 인식과 AI 전략을 정의하는 데이터베이스.
사용자가 직접 단계를 추가/수정/삭제할 수 있음.

| 속성명 | 속성 타입 | 필수 | 설명 | 예시 |
|--------|----------|------|------|------|
| 단계명 | Title | ✅ | 세일즈 단계 이름 | "라포 형성" |
| 순서 | Number | ✅ | 단계 순서 (정렬용) | 2 |
| 목표인식 | Text | ✅ | 고객이 가져야 할 인식 | "이 사람 괜찮은듯" |
| AI지시 | Text | ✅ | AI가 이 단계에서 할 일 | "공감 포인트 찾기, 공통점 발견" |
| 핵심질문 | Text | | 이 단계에서 던질 질문들 | "요즘 외국인 환자 많으세요?" |
| 전환신호 | Text | | 다음 단계로 넘어갈 신호 | "구체적인 질문을 시작함" |
| 주의사항 | Text | | 이 단계에서 하지 말 것 | "상품 얘기 먼저 꺼내지 말 것" |
| 활성화 | Checkbox | ✅ | 사용 여부 | ✅ |

#### 샘플 데이터 (기본 세일즈 단계)

```markdown
# 단계명: 첫 대화
# 순서: 1
# 목표인식: "이 사람 뭐하는 사람이지?"
# AI지시: 신뢰감 있는 자기소개 유도, 상대방이 편하게 느끼도록
# 핵심질문: -
# 전환신호: 상대방이 질문을 시작하거나 관심 표현
# 주의사항: 바로 영업 얘기 꺼내지 말 것
# 활성화: ✅
```

```markdown
# 단계명: 라포 형성
# 순서: 2
# 목표인식: "괜찮은 사람인듯"
# AI지시: 공감 포인트 찾기, 공통 관심사/경험 발견
# 핵심질문: "요즘 어떠세요?", "그 부분 힘드시죠"
# 전환신호: 상대방이 자신의 상황/고민을 공유하기 시작
# 주의사항: 상품 언급 자제
# 활성화: ✅
```

```markdown
# 단계명: 가치 소개
# 순서: 3
# 목표인식: "이게 나한테 필요한가?"
# AI지시: 상품을 고객 상황에 연결, 구체적 혜택 설명
# 핵심질문: "혹시 이런 부분 고민되셨어요?"
# 전환신호: "얼마예요?", "어떻게 진행돼요?" 등 구체적 질문
# 주의사항: 기능 나열 금지, 혜택 중심으로
# 활성화: ✅
```

```markdown
# 단계명: 니즈 파악 (5Whys)
# 순서: 4
# 목표인식: "내 진짜 문제가 뭐지?"
# AI지시: 5Whys 기법으로 진짜 니즈 발굴, 표면적 요청 뒤의 본질 찾기
# 핵심질문: "왜 그게 필요하세요?", "그게 해결되면 뭐가 달라지나요?"
# 전환신호: 고객이 "사실은...", "진짜 원하는 건..." 표현
# 주의사항: 심문하듯 묻지 말 것, 자연스럽게
# 활성화: ✅
```

```markdown
# 단계명: 핵심 문제 짚기
# 순서: 5
# 목표인식: "이 사람이 내 문제를 정확히 안다"
# AI지시: 고객 니즈 요약해서 되짚어주기, "~이런 상황이시네요" 확인
# 핵심질문: "정리하면 ~이런 상황이신 거죠?"
# 전환신호: "맞아요", "그렇죠" 등 동의 표현
# 주의사항: 틀리게 요약하면 신뢰 깨짐
# 활성화: ✅
```

```markdown
# 단계명: 클로징
# 순서: 6
# 목표인식: "해야겠다"
# AI지시: 결정 유도, 다음 스텝 제안, 행동 촉구
# 핵심질문: "언제 시작하실까요?", "어떤 플랜으로 할까요?"
# 전환신호: 계약/결제 의사 표현
# 주의사항: 압박 금지, 선택권 부여
# 활성화: ✅
```

---

### 2.5 세일즈 전략 DB

AI 응답 생성에 사용되는 전체적인 세일즈 톤/스타일 프리셋.
(단계별 전략과 별개로, 전체 대화 톤을 설정)

| 속성명 | 속성 타입 | 필수 | 설명 | 예시 |
|--------|----------|------|------|------|
| 전략명 | Title | ✅ | 프리셋 이름 | "기본 전략" |
| 페르소나 | Text | ✅ | 나의 말투/톤/이미지 | "전문적이지만 친근하게" |
| 금지사항 | Text | | 하지 말아야 할 것 | "과도한 할인 언급 금지" |
| 시스템프롬프트 | Text | | AI 추가 지시사항 | "항상 ROI 관점으로 설명" |
| 기본값 | Checkbox | | 기본 전략 여부 | ✅ |

#### 샘플 데이터

```markdown
# 전략명: 기본 전략
# 페르소나:
말투: 전문적이지만 친근하게
톤: 확신 있지만 밀어붙이지 않게
특징: 고객 입장에서 먼저 생각하는

# 금지사항:
- 과도한 할인 언급 금지
- 경쟁사 비방 금지
- 허위 정보 금지
- 압박성 멘트 금지

# 시스템프롬프트:
응답은 항상 고객의 입장에서 시작하세요.
숫자와 구체적인 사례를 활용하세요.
너무 길지 않게, 카톡 메시지 2-3개 분량으로 작성하세요.

# 기본값: ✅
```

```markdown
# 전략명: 공격적 클로징
# 페르소나:
말투: 자신감 있게
톤: 확고하지만 존중하는
특징: 결정을 이끌어내는

# 금지사항:
- 경쟁사 비방 금지
- 허위 정보 금지

# 시스템프롬프트:
지금 결정해야 하는 이유를 강조하세요.
놓치면 손해라는 프레임을 사용하세요.
단, 압박감이 아닌 기회 손실로 표현하세요.

# 기본값: ❌
```

---

## 3. TypeScript 타입 정의

```typescript
// types/notion.ts

// Notion에서 가져온 고객 데이터
export interface Customer {
  id: string;                    // Notion 페이지 ID
  name: string;                  // 업장명
  contact: string;               // 담당자
  phone: string;                 // 연락처
  email: string;                 // 이메일
  status: CustomerStatus;        // 상태
  memo: string;                  // 상담메모
  nextAction: string;            // 다음액션
  lastContact: string;           // 최근연락일 (ISO string)
  address?: string;              // 주소
  category?: string;             // 분류
  expectedRevenue?: number;      // 예상매출
  source?: string;               // 유입경로
  contactMemo?: string;          // 담당자메모
  notionUrl: string;             // Notion URL
}

export type CustomerStatus =
  | '리드'
  | '상담중'
  | '계약완료'
  | '이탈'
  | '보류';

// Notion에서 가져온 스크립트 데이터
export interface Script {
  id: string;                    // Notion 페이지 ID
  title: string;                 // 제목
  category: ScriptCategory;      // 카테고리
  content: string;               // 내용
  tags: string[];                // 태그
  useCount: number;              // 사용빈도
  memo?: string;                 // 메모
  effectiveSituation?: string;   // 효과적인상황
  notionUrl: string;             // Notion URL
}

export type ScriptCategory =
  | '첫 연락'
  | '관심 표현'
  | '질문 응대'
  | '이의 제기'
  | '클로징'
  | '후속 관리';

// Notion에서 가져온 자료 데이터
export interface Material {
  id: string;                    // Notion 페이지 ID
  title: string;                 // 자료명
  category: MaterialCategory;    // 카테고리
  url: string;                   // 링크
  description?: string;          // 설명
  fileType?: string;             // 파일형식
  lastModified?: string;         // 최종수정일
  notionUrl: string;             // Notion URL
}

export type MaterialCategory =
  | '소개'
  | '가격'
  | '사례'
  | '계약';

// Notion에서 가져온 세일즈 단계 데이터
export interface SalesStage {
  id: string;                    // Notion 페이지 ID
  name: string;                  // 단계명
  order: number;                 // 순서
  targetPerception: string;      // 목표인식
  aiInstruction: string;         // AI지시
  keyQuestions?: string;         // 핵심질문
  transitionSignal?: string;     // 전환신호
  caution?: string;              // 주의사항
  isActive: boolean;             // 활성화 여부
  notionUrl: string;             // Notion URL
}

// Notion에서 가져온 세일즈 전략 데이터 (전체 톤/스타일)
export interface Strategy {
  id: string;                    // Notion 페이지 ID
  name: string;                  // 전략명
  persona: string;               // 페르소나
  restrictions: string;          // 금지사항
  systemPrompt: string;          // 시스템프롬프트
  isDefault: boolean;            // 기본값 여부
}

// AI 분석 결과
export interface AnalysisResult {
  currentStage: SalesStage;      // 현재 단계 (자동 감지)
  currentEmotion: string;        // 현재 고객 감정
  emotionSignals: string[];      // 감정 판단 근거
  nextStage?: SalesStage;        // 다음 단계 (전환 가능 시)
  stageStrategy: string;         // 현재 단계 전략 설명
  suggestedResponse: string;     // 추천 멘트
  suggestedQuestions: string[];  // 추천 질문들
  relatedScripts: string[];      // 관련 스크립트 키워드
}
```

---

## 4. Notion DB 설정 가이드

### 5.1 Integration 생성

1. https://www.notion.so/my-integrations 접속
2. "새 API 통합" 클릭
3. 이름 입력: "Sales Assistant"
4. 기능 선택:
   - ✅ 콘텐츠 읽기
   - ✅ 콘텐츠 업데이트
   - ✅ 콘텐츠 삽입
5. API 키 복사 → `.env.local`에 저장

### 5.2 DB에 Integration 연결

1. 각 DB 페이지 열기
2. 우측 상단 "..." 클릭
3. "연결" → "Sales Assistant" 선택

### 5.3 DB ID 확인

DB URL에서 ID 추출:
```
https://notion.so/workspace/1234567890abcdef1234567890abcdef?v=...
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                            이 부분이 DB ID
```

---

## 5. 환경 변수 설정

```env
# .env.local

# Notion
NOTION_API_KEY=secret_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_CUSTOMER_DB_ID=1234567890abcdef1234567890abcdef
NOTION_SCRIPT_DB_ID=1234567890abcdef1234567890abcdef
NOTION_MATERIAL_DB_ID=1234567890abcdef1234567890abcdef
NOTION_STAGE_DB_ID=1234567890abcdef1234567890abcdef
NOTION_STRATEGY_DB_ID=1234567890abcdef1234567890abcdef

# Gemini
GEMINI_API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

## 6. 데이터 흐름

```
[사용자 작업]
     │
     ▼
┌─────────────────────────────────────────────────────────┐
│                      앱 (Next.js)                        │
├─────────────────────────────────────────────────────────┤
│  1. 고객 선택      →  Notion API로 고객 정보 조회        │
│  2. 대화 내용 입력  →  텍스트 붙여넣기                   │
│  3. AI 분석 요청   →  Gemini API 호출                    │
│  4. 결과 표시      →  감정 분석 + 추천 멘트 표시         │
│  5. 멘트 복사      →  클립보드에 복사                    │
└─────────────────────────────────────────────────────────┘
```
